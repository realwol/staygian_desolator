<div id="variableSearch">
  <%= form_tag(variable_search_variables_path, remote:true, method: 'get') do %>
    <%= label_tag '要搜索的变体名称：' %>
    <%= text_field_tag 'variable_name', params[:variable_name] %>
    <%= submit_tag '确定' %>
  <% end %>
  <div id="variableSearchTable">
    <% if @search_result.present? %>
    <table class="table table-bordered">
      <tr>
        <% %w(中国 美国 加拿大 英国 德国 法国 西班牙 意大利).each do |country| %>
          <td><%= country %></td>
        <% end %>
        <td colspan="2" >操作</td>
      </tr>
        <% @search_result.each do |variable| %>
          <tr>
            <td><input type="text" class="variable_translation_name" style="width:80px;" value=<%= variable.word %> ></td>
            <td><input type="text" class="variable_translation_value" style="width:80px;" value=<%= variable.try(:en) %> ></td>
            <td><input type="text" class="variable_translation_value" style="width:80px;" value=<%= variable.try(:en) %> ></td>
            <td><input type="text" class="variable_translation_value" style="width:80px;" value=<%= variable.try(:en) %> ></td>
            <td><input type="text" class="variable_translation_value" style="width:80px;" value=<%= variable.try(:de) %> ></td>
            <td><input type="text" class="variable_translation_value" style="width:80px;" value=<%= variable.try(:fr) %> ></td>
            <td><input type="text" class="variable_translation_value" style="width:80px;" value=<%= variable.try(:es) %> ></td>
            <td><input type="text" class="variable_translation_value" style="width:80px;" value=<%= variable.try(:it) %> ></td>
            <% if variable.user == current_user || current_user.is_dd? %>
              <td><a class="update_translation" data-variable-type='size' value=<%= variable.word %>>更新</a> </td>
              <td><a class="remove_translation" data-variable-type='size' value=<%= variable.word %>>删除</a> </td>
            <% else %>
              <td></td>
              <td></td>
            <% end %>
          </tr>
        <% end %>
      </table>
      <button id="closevariableSearch" >关闭</button>
    <% else %>
    <% end %>
  </div>
</div>
<script type="text/javascript">
  $('#closevariableSearch').click(function(){
    $('#variableSearchTable').hide('blind', {}, 500);
  })

    $('.update_translation').click(function(){
      var variableTranslationValue = '';
      $(this).parents('tr').find('.variable_translation_value').each(function(){
        variableTranslationValue =  variableTranslationValue + $(this).val() + ',' ;
      });
      var variableNewName = $(this).parents('tr').find('.variable_translation_name').val();
      var variableName = $(this).parents('tr').find('.variable_translation_name').val();
      var oldVariableName = $(this).attr('value');
      var variableType = $(this).data('variable-type');

      $.ajax({
        url: '/variables/update_translate_variable',
        type: 'post',
        data: {variableTranslationValue: variableTranslationValue, variableName: variableName, oldVariableName: oldVariableName, variableType: variableType},
        success: function(){
          alert('操作成功！');
        }
      });
      return false;
    });

    $('.remove_translation').click(function(){
      var $trLine = $(this).parents('tr');
      var variableName = $(this).parents('tr').find('.variable_translation_name').val();
      var variableType = $(this).data('variable-type');

      $.ajax({
        url: '/variables/remove_translate_variable',
        type: 'delete',
        data: { variableName: variableName, variableType: variableType },
        success: function(data){
          if (data == 1) {
            alert('该变体正在使用，不可删除！');
          } else {
            $trLine.remove();
            alert('操作成功！');
          }
        }
      });
      return false;
    });
</script>