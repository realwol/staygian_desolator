<% if current_user.is_dd? %>
  <%= render 'update_div' %>
<% end %>
<h4>排行榜</h4>
<div id="listTabs" >
  <ul>
    <li><a href="#listTab-1">今日</a></li>
    <li><a href="#listTab-2">最近30天</a></li>
    <li><a href="#listTab-3">历史</a></li>
  </ul>
  <div id="listTab-1">
  <h5>当天统计</h5>
  <table class="table table-bordered table-striped">
    <tr>
      <th>人员</th>
      <th>组长</th>
      <th>组内排名</th>
      <th>全部排名</th>
      <th>上线产品数</th>
    </tr>
    </tr>
    <% count1, count2 = 1, 1 %>
    <% @today_rank_user_products.each_with_index do |user_product, index| %>
      <% user_index = @rank_users.map(&:id).index(user_product.user_id) %>
      <% if user_index.present? %>
        <% user = User.find(@today_rank_user_products[index].user_id) %>
        <% user_rank_info = @today_rank_user_products[index] %>
        <tr>
          <td><%= user.username %></td>
          <td><%= user.try(:leader).try(:username) %></td>
          <td><%= count1 %></td>
          <td><%= count2 %></td>
          <td><%= user_rank_info.user_count %></td>
        </tr>
        <% count1 = count1 + 1 %>
      <% end %>
      <% count2 = count2 + 1 %>
    <% end %>
    <% unless current_user.is_dd? %>
      <tr>
        <td>总计</td>
        <td></td>
        <td><%= Time.now.strftime("%Y-%m-%d") %></td>
      </tr>
    <% end %>
  </table>

  <table class="table table-bordered" >
    <tr>
      <th>组长</th>
      <th>排名</th>
      <th>产品总数</th>
    </tr>
    <% current_user.get_day_group_rank.each_with_index do |group, index| %>
      <tr>
        <td><%= group.third %></td>
        <td><%= index + 1 %></td>
        <td><%= group.second %></td>
      </tr>
    <% end %>
  </table>
  </div>
  <div id="listTab-2">
<h5>最近30天统计</h5>
<table class="table table-bordered table-striped">
  <tr>
    <th>人员</th>
    <th>组长</th>
    <th>组内排名</th>
    <th>全部排名</th>
    <th>上线产品数</th>
  </tr>
  </tr>
  <% count1, count2 = 1, 1 %>
  <% @month_rank_user_products.each_with_index do |user_product, index| %>
    <% user_index = @rank_users.map(&:id).index(user_product.user_id) %>
    <% if user_index.present? %>
      <% user = User.find(@month_rank_user_products[index].user_id) %>
      <% user_rank_info = @month_rank_user_products[index] %>
      <tr>
        <td><%= user.username %></td>
        <td><%= user.try(:leader).try(:username) %></td>
        <td><%= count1 %></td>
        <td><%= count2 %></td>
        <td><%= user_rank_info.user_count %></td>
      </tr>
      <% count1 = count1 + 1 %>
    <% end %>
    <% count2 = count2 + 1 %>
  <% end %>
  <% unless current_user.is_dd? %>
    <tr>
      <td>总计</td>
      <td></td>
      <td><%= Time.now.strftime("%Y-%m-%d") %></td>
    </tr>
  <% end %>
</table>
<table class="table table-bordered" >
  <tr>
    <th>组长</th>
    <th>排名</th>
    <th>产品总数</th>
  </tr>
  <% current_user.get_month_group_rank.each_with_index do |group, index| %>
    <tr>
      <td><%= group.third %></td>
      <td><%= index + 1 %></td>
      <td><%= group.second %></td>
    </tr>
  <% end %>
</table>

  </div>
  <div id="listTab-3">
<h5>历史统计</h5>
<table class="table table-bordered table-striped">
  <tr>
    <th>人员</th>
    <th>组长</th>
    <th>组内排名</th>
    <th>全部排名</th>
    <th>上线产品数</th>
  </tr>
  </tr>
  <% count1, count2 = 1, 1 %>
  <% @all_rank_user_products.each_with_index do |user_product, index| %>
    <% user_index = @rank_users.map(&:id).index(user_product.user_id) %>
    <% if user_index.present? %>
      <% user = User.find(@all_rank_user_products[index].user_id) %>
      <% user_rank_info = @all_rank_user_products[index] %>
      <tr>
        <td><%= user.username %></td>
        <td><%= user.try(:leader).try(:username) %></td>
        <td><%= count1 %></td>
        <td><%= count2 %></td>
        <td><%= user_rank_info.user_count %></td>
      </tr>
      <% count1 = count1 + 1 %>
    <% end %>
    <% count2 = count2 + 1 %>
  <% end %>
  <% unless current_user.is_dd? %>
    <tr>
      <td>总计</td>
      <td></td>
      <td><%= Time.now.strftime("%Y-%m-%d") %></td>
    </tr>
  <% end %>
</table>
<table class="table table-bordered" >
  <tr>
    <th>组长</th>
    <th>排名</th>
    <th>产品总数</th>
  </tr>
  <% current_user.get_his_group_rank.each_with_index do |group, index| %>
    <tr>
      <td><%= group.third %></td>
      <td><%= index + 1 %></td>
      <td><%= group.second %></td>
    </tr>
  <% end %>
</table>
  </div>
</div>

<script type="text/javascript">
  $('#listTabs').tabs();
</script>
