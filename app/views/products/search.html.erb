<h4>
  <%= @result_type %>查询结果:<%= @search_value? @search_value.total_count : 0 %>件产品
</h4>
<% if @search_value %>
  <table class='table table-bordered'>
    <thead>
      <tr>
        <th>产品类型</th>
        <th>产品题目</th>
        <th>SKU</th>
        <th>产品号码</th>
        <th>创建者</th>
        <th>操作</th>
      </tr>
    </thead>

    <tbody>
      <% @search_value.each do |product| %>
        <tr>
          <td><%= link_to product.product_type.name, product_type_path(product.product_type) if product.product_type%></td>
          <td><%= product.title %></td>
          <td><%= product.sku %></td>
          <td><%= product.product_number %></td>
          <td><%= product.user.email %></td>
          <td>
            <%= link_to '翻译预览', translate_preview_product_path(product) %>
            <%= link_to '编辑', edit_product_path(product) %>
            <%= link_to '屏蔽', shield_product_product_path(product) %>
            <%= link_to '下架', offsale_product_product_path(product) %>
            <%= link_to '临时下架', temp_offsale_product_product_path(product) %>
            <a href="#" class="reGraspProduct" data-product-id="<%= product.id %>" >重新抓取</a>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <%= paginate @search_value %>
<% end %>

  <%= form_tag temp_off_sale_all_products_path do %>
    <%= hidden_field_tag 'all_products', nil, value: @search_value.map(&:id).join(' ') %>
    <%= submit_tag '全部临时下架' %>
  <% end %>
  <%= form_tag off_sale_all_products_path do %>
    <%= hidden_field_tag 'all_offsale_products', nil, value: @search_value.map(&:id).join(' ') %>
    <%= submit_tag '全部下架' %>
  <% end %>
  <%= form_tag on_sale_all_products_path do %>
    <%= hidden_field_tag 'all_onsale_products', nil, value: @search_value.map(&:id).join(' ') %>
    <%= submit_tag '全部上架' %>
  <% end %>
  <%= form_tag shield_all_products_path do %>
    <%= hidden_field_tag 'all_shield_products', nil, value: @search_value.map(&:id).join(' ') %>
    <%= submit_tag '全部屏蔽' %>
  <% end %>

<%= link_to '更改产品分类', change_product_type_products_path(product_id: @search_value.map(&:id)) %>
<%= link_to '返回', root_path %>

<script type="text/javascript">
  $('.reGraspProduct').click(function(){
    var productId = $(this).data('product-id');
    var $this = $(this);
    $.ajax({
      url: '/products/'+ productId +'/regrasp_product',
      type: 'get',
      success: function(){
        $this.parents('tr').remove();
        alert('操作成功！');
      }
    })
  })
</script>
